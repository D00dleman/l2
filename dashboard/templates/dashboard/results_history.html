{% extends "dbase.html" %}
{% block title %}Печать результатов{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-xs-4 col-xs-offset-4">
            <div class="row">
                <div class="col-xs-7" style="text-align: right;line-height: 1.26;">
                    <label for="dateday-otd">
                        Дата подтверждения результата:
                    </label>
                </div>
                <div class="col-xs-5">
                    <input type="text" class="form-control no-context" id="dateday-otd" style="display: inline-block"
                           name="dateday-otd"/>
                </div>
            </div>
            <div class="btn btn-blue-nb" onclick="print_results('otd');"
                 style="display: inline-block;width: 100%;margin-bottom: 5px;margin-top: 5px">
                Печать результатов для отделения
            </div>
            <br/>
            <div class="btn btn-blue-nb" onclick="print_results('pac');" style="display: inline-block;width: 100%">
                Печать результатов для пациентов
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
    <script src="/static/js/bootstrap-datepicker.min.js"></script>
    <script src="/static/locales/bootstrap-datepicker.ru.min.js"></script>
    <script>
        $(document).ready(function () {
            $('head').append('<link rel="stylesheet" href="/static/css/bootstrap-datepicker3.standalone.min.css" type="text/css" />');

            $("[name='dateday-otd']").val(getFormattedDate(new Date())).datepicker({
                format: "dd.mm.yyyy",
                todayBtn: "linked",
                language: "ru",
                autoclose: true,
                todayHighlight: true,
                enableOnReadonly: true,
                orientation: "top left"
            });
        });
        function chunk(arr, len) {
            var chunks = [],
                    i = 0,
                    n = arr.length;

            while (i < n) {
                chunks.push(arr.slice(i, i += len));
            }

            return chunks;
        }

        function print_results(type) {
            sl();
            $.ajax({
                url: "/dashboard/results_history/search",
                data: {type: type, date: $("[name='dateday-otd']").val()},
                method: "GET"
            }).done(function (data) {
                hl();
                if (data.length == 0) {
                    $.amaran({
                        'theme': 'awesome wrn',
                        'content': {
                            title: "Печать невозможна",
                            message: "Ничего не найдено",
                            info: '',
                            icon: 'fa fa-exclamation'
                        },
                        'position': 'bottom right',
                        delay: 6000
                    });
                } else {
                    c = chunk(data, 155);
                    for (var k = 0; k < c.length; k++) {
                        (function (e) {
                            setTimeout(function () {
                                st = "?pk=[" + c[e].join(",") + "]";
                                window.open('/results/pdf' + st, '_blank');
                            }, 1000 * e);
                        })(k);
                    }
                }
            });
        }
    </script>
    <style>

    </style>
{% endblock %}